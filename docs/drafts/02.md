# Admin Dashboard - User Management with Better Auth

## Overview

A **minimal, elegant admin dashboard** for user management built on top of Better Auth's Admin plugin. Designed specifically to be **embedded in an iframe**, featuring a clean, distraction-free interface with shadcn/ui components.

### Design Principles

- **Minimalist** - Clean UI with no unnecessary elements
- **Iframe-friendly** - Works perfectly when embedded in other applications
- **Fast & Responsive** - Optimistic updates, instant feedback
- **Accessible** - Keyboard navigation, ARIA labels, semantic HTML
- **Monochromatic** - Subtle color palette focusing on content over decoration

## Design System

### Color Palette (Minimal & Monochromatic)

**Primary Palette** - Use shadcn default theme with subtle customizations:
- **Background**: `hsl(0 0% 100%)` - Pure white
- **Foreground**: `hsl(240 10% 3.9%)` - Near black for text
- **Muted**: `hsl(240 4.8% 95.9%)` - Light gray backgrounds
- **Border**: `hsl(240 5.9% 90%)` - Subtle borders
- **Accent**: `hsl(240 4.8% 95.9%)` - Hover states

**Semantic Colors** - Only for status and actions:
- **Destructive**: `hsl(0 84.2% 60.2%)` - Delete/ban actions (use sparingly)
- **Success**: `hsl(142 76% 36%)` - Success toasts only
- **Warning**: `hsl(38 92% 50%)` - Warning states
- **Primary**: `hsl(240 5.9% 10%)` - Action buttons (dark, minimal)

**Status Badges** - Minimal, text-first design:
- **Admin role**: `hsl(240 5.9% 10%)` background, white text, small pill
- **User role**: `hsl(240 4.8% 95.9%)` background, foreground text, small pill
- **Banned**: `hsl(0 84.2% 60.2%)` background, white text, small pill
- **Active session**: `hsl(142 76% 36%)` dot indicator (no text)

### Typography

**Font Stack**: System fonts for performance in iframe
```css
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
```

**Type Scale** - Minimal hierarchy:
- **Page Title**: `text-2xl` (24px), `font-semibold`, `tracking-tight`
- **Section Heading**: `text-lg` (18px), `font-medium`
- **Table Headers**: `text-sm` (14px), `font-medium`, `uppercase tracking-wide text-muted-foreground`
- **Body Text**: `text-sm` (14px), `font-normal`
- **Small Text**: `text-xs` (12px), `text-muted-foreground`
- **Monospace** (emails, IDs): `font-mono text-xs`

**Line Height**:
- Headings: `leading-tight` (1.25)
- Body: `leading-normal` (1.5)

### Spacing System

Use Tailwind's spacing scale consistently:
- **Component padding**: `p-4` or `p-6` (16px/24px)
- **Section gaps**: `gap-6` or `gap-8` (24px/32px)
- **Element spacing**: `space-y-4` (16px vertical rhythm)
- **Tight spacing**: `gap-2` (8px for related items)
- **Table cell padding**: `px-4 py-2` (compact, spreadsheet-like)

### Layout Structure

**Iframe-Optimized Layout** - No fixed headers, everything scrolls naturally:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Page Content - Full Height Scroll]         â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Page Header (inline, not fixed)     â”‚   â”‚
â”‚ â”‚ - Breadcrumb                         â”‚   â”‚
â”‚ â”‚ - Page Title                         â”‚   â”‚
â”‚ â”‚ - Primary Action Button (right)      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Toolbar (inline)                     â”‚   â”‚
â”‚ â”‚ - Search                             â”‚   â”‚
â”‚ â”‚ - Filters (minimal)                  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Data Table                           â”‚   â”‚
â”‚ â”‚ - Clean borders                      â”‚   â”‚
â”‚ â”‚ - Compact rows                       â”‚   â”‚
â”‚ â”‚ - Hover states                       â”‚   â”‚
â”‚ â”‚                                      â”‚   â”‚
â”‚ â”‚ [Pagination at bottom]               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Container Width**:
- Max width: `none` - Fill iframe width completely
- Padding: `px-4 md:px-6` - Responsive gutters
- No centering - edge-to-edge design for iframe

**Scroll Behavior**:
- Main content scrolls within iframe
- NO fixed/sticky headers (breaks in iframe)
- Dialogs use `fixed` positioning relative to iframe viewport
- Table headers can be sticky WITHIN table container only

### Component Specifications

#### Data Table
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Name                Email              Role    Created   â‹®    â”‚ â† Header: sticky within container
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Alice Johnson      alice@example.com  Admin   Jan 15   ...  â”‚ â† Row: hover bg-muted
â”‚ Bob Smith          bob@example.com    User    Jan 14   ...  â”‚
â”‚ Carol White        carol@example.com  User    Jan 13   ...  â”‚ â† Banned row: subtle red tint
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Specifications**:
- Border: `border` (all sides), `rounded-lg`
- Row height: `h-12` (compact)
- Hover: `hover:bg-muted/50`
- Cell padding: `px-4 py-2`
- Header: `bg-muted/30`, `text-xs`, `font-medium`, `uppercase`, `tracking-wide`
- Banned row: `bg-destructive/5` (subtle tint)
- Font: `text-sm` for cells, `text-xs` for headers
- Alternating rows: NO (too busy, use hover instead)

#### Toolbar
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ” Search users...]  [Role: All â–¾]  [Columns â–¾]  [+ User]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Specifications**:
- Height: `h-14` (56px)
- Background: transparent
- Border bottom: `border-b`
- Items: `flex items-center gap-2`
- Search: `flex-1` (grow), `max-w-sm`
- Filters: `w-[180px]`
- Actions: `ml-auto` (push right)

#### Dialogs

**Minimal Dialog Design**:
```
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Create User              [âœ•]   â”‚ â† Header: border-b
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                â”‚
       â”‚ Email                          â”‚
       â”‚ [alice@example.com        ]    â”‚
       â”‚                                â”‚
       â”‚ Name                           â”‚
       â”‚ [Alice Johnson            ]    â”‚
       â”‚                                â”‚
       â”‚ Password                       â”‚
       â”‚ [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                 ]    â”‚
       â”‚                                â”‚
       â”‚ Role                           â”‚
       â”‚ [User                    â–¾]    â”‚
       â”‚                                â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚              [Cancel] [Create] â”‚ â† Footer: border-t
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Specifications**:
- Width: `max-w-md` (448px) for forms, `max-w-2xl` for tables
- Padding: `p-6`
- Background: `bg-background`
- Border: `border shadow-lg`
- Rounded: `rounded-lg`
- Overlay: `bg-black/50`
- Position: `fixed` within iframe viewport
- Header: `pb-4 border-b`, `text-lg font-semibold`
- Footer: `pt-4 border-t`, `flex justify-end gap-2`
- Form spacing: `space-y-4`

#### Buttons

**Primary Action** (Create, Save, Confirm):
```css
bg-primary text-primary-foreground hover:bg-primary/90
h-9 px-4 text-sm font-medium rounded-md
```

**Secondary Action** (Cancel):
```css
bg-muted hover:bg-muted/80 text-foreground
h-9 px-4 text-sm font-medium rounded-md
```

**Destructive Action** (Delete, Ban):
```css
bg-destructive text-destructive-foreground hover:bg-destructive/90
h-9 px-4 text-sm font-medium rounded-md
```

**Ghost Button** (Row actions):
```css
hover:bg-muted hover:text-foreground
h-8 w-8 p-0 rounded-md
```

#### Form Inputs

**Text Input**:
```css
border border-input bg-background
h-9 px-3 py-2 text-sm rounded-md
focus:outline-none focus:ring-2 focus:ring-ring
placeholder:text-muted-foreground
```

**Select Dropdown**:
```css
Same as text input + pr-8 (space for chevron)
```

**Label**:
```css
text-sm font-medium mb-1.5 block
```

#### Badges

**Minimal Pill Badges**:
```css
inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
```

- Admin: `bg-primary text-primary-foreground`
- User: `bg-muted text-muted-foreground`
- Banned: `bg-destructive text-destructive-foreground`

#### Dropdown Menu (Row Actions)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœï¸  Edit User    â”‚
â”‚ ğŸ”‘ Reset Passwordâ”‚
â”‚ ğŸ‘¤ Change Role   â”‚
â”‚ ğŸ”’ View Sessions â”‚
â”‚ ğŸ‘ï¸  Impersonate  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† Separator before destructive
â”‚ ğŸš« Ban User      â”‚
â”‚ ğŸ—‘ï¸  Delete User  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Specifications**:
- Width: `min-w-[160px]`
- Background: `bg-popover`, `border`, `shadow-md`
- Rounded: `rounded-md`
- Padding: `p-1`
- Item height: `h-9`
- Item padding: `px-2`
- Item hover: `bg-muted`
- Separator: `border-t my-1`
- Destructive items: `text-destructive` (no bg change until hover)
- Icons: `mr-2 h-4 w-4 text-muted-foreground`

### Icons

**Use lucide-react consistently** - Minimal, 16px icons:
- Search: `Search`
- Filter: `Filter`
- Sort: `ArrowUpDown`, `ArrowUp`, `ArrowDown`
- Actions: `MoreHorizontal` (three dots)
- Edit: `Pencil`
- Delete: `Trash2`
- Ban: `Ban`
- User: `User`
- Shield: `Shield` (admin)
- Key: `Key` (password)
- Eye: `Eye` (view/impersonate)
- Check: `Check` (success)
- X: `X` (close, error)
- ChevronDown: `ChevronDown` (dropdowns)
- Plus: `Plus` (create)

**Icon sizing**:
- Table/buttons: `h-4 w-4` (16px)
- Dialog close: `h-4 w-4`
- Badge icons: `h-3 w-3` (12px)

### Animations

**Minimal, fast animations** for better iframe performance:

- Dialog enter/exit: `duration-200 ease-out`
- Hover states: `transition-colors duration-150`
- Loading spinners: `animate-spin` (only when necessary)
- Toast notifications: `duration-300 ease-in-out`
- NO page transitions
- NO skeleton loaders (use simple "Loading..." text)

### Responsive Breakpoints

**Mobile-first, iframe-aware**:
- `sm: 640px` - Stack toolbar items
- `md: 768px` - Full table layout
- `lg: 1024px` - Wider dialogs

**Table responsiveness**:
- Mobile: Horizontal scroll with `overflow-x-auto`
- Tablet+: Full table visible
- Always show essential columns (name, email, actions)

### Iframe Compatibility Guidelines

#### 1. **No Fixed Positioning Outside Dialogs**
- NEVER use `fixed` for headers/footers
- All content scrolls naturally within iframe
- Dialogs can use `fixed` (scoped to iframe viewport)

#### 2. **Scroll Management**
```typescript
// Let parent control outer scroll, we control inner scroll
<div className="h-full overflow-y-auto">
  {/* Page content */}
</div>
```

#### 3. **Dialog Positioning**
```typescript
// Use portals for dialogs, but stay within iframe
<Dialog>
  <DialogOverlay className="fixed inset-0" /> {/* Scoped to iframe */}
  <DialogContent className="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2" />
</Dialog>
```

#### 4. **Focus Management**
- Trap focus within dialogs
- Return focus to trigger element on close
- Ensure keyboard navigation works across iframe boundary

#### 5. **No External Links**
- All navigation stays within iframe
- If external links needed, use `postMessage` to parent

#### 6. **Error Boundaries**
- Graceful error handling that doesn't break parent app
- Show error UI within iframe, don't throw to parent

#### 7. **Performance in iframe**
- Minimize re-renders (Jotai helps)
- Virtual scrolling for large lists (future enhancement)
- Lazy load dialogs
- Optimize images (none expected in admin panel)

## Functional Specifications

### Preconditions
- User is authenticated
- User has `admin` role or is in `adminUserIds` list
- Better Auth Admin plugin is configured in `lib/auth.ts`
- Admin client plugin is configured in `lib/auth-client.ts`

### Workflow

**Admin Dashboard Home**
1. Admin navigates to `/admin`
2. System displays minimal dashboard with:
   - **Page header**: "Admin Dashboard" (text-2xl, font-semibold)
   - **Stats grid** (3 cards in row, responsive):
     - Total Users (number + label)
     - Active Sessions (number + label)
     - Banned Users (number + label, red if > 0)
   - **Quick action**: "Manage Users" button (primary, navigates to /admin/users)
   - **Optional**: Recent activity list (future enhancement)
3. Design notes:
   - No charts/graphs (too busy for minimal design)
   - Just numbers and clean cards
   - Focus on getting to user management quickly

**List Users**
1. Admin navigates to `/admin/users`
2. System displays data table with all users showing:
   - Email, name, role, created date, banned status
   - Search bar (by email or name)
   - Filter by role dropdown
   - Sort by columns (email, name, createdAt)
   - Pagination (10 users per page)
3. Each row has actions menu: View, Edit, Ban/Unban, Delete, Impersonate

**Create User**
1. Admin clicks "Create User" button
2. Dialog opens with form fields:
   - Email (required)
   - Name (required)
   - Password (required, min 8 chars)
   - Role (dropdown: user, admin)
3. Admin fills form and submits
4. System validates and creates user
5. User appears in table with optimistic update

**Edit User**
1. Admin clicks "Edit" on a user row
2. Dialog opens with pre-filled form:
   - Email, name, role
3. Admin updates fields and submits
4. System updates user with optimistic update

**Set User Role**
1. Admin clicks "Change Role" on a user row
2. Dialog shows current role and dropdown with available roles
3. Admin selects new role and confirms
4. System updates user role with optimistic update

**Ban/Unban User**
1. Admin clicks "Ban" on a user row
2. Dialog opens with:
   - Ban reason (text input)
   - Ban expires in (optional, number input in days)
3. Admin submits ban
4. System bans user, revokes all sessions
5. User row shows "Banned" badge
6. To unban: Admin clicks "Unban", confirms, user is unbanned

**Delete User**
1. Admin clicks "Delete" on a user row
2. Confirmation dialog appears with warning
3. Admin confirms deletion
4. System hard deletes user from database
5. User removed from table with optimistic update

**Impersonate User**
1. Admin clicks "Impersonate" on a user row
2. Confirmation dialog appears
3. Admin confirms impersonation
4. System creates impersonation session (1 hour duration)
5. Admin is redirected to app as that user
6. Top banner shows "Impersonating [User Name]" with "Stop" button
7. Admin can navigate app as that user
8. To stop: Admin clicks "Stop Impersonating"

**Manage User Sessions**
1. Admin clicks "View Sessions" on a user row
2. Dialog opens showing all active sessions:
   - Session token (truncated)
   - IP address (if available)
   - User agent
   - Created at
   - "Revoke" button per session
3. Admin can revoke individual session or "Revoke All Sessions"
4. System revokes sessions with optimistic update

**Set User Password**
1. Admin clicks "Reset Password" on a user row
2. Dialog opens with new password input
3. Admin enters new password and submits
4. System updates user password
5. Success toast appears

### Postconditions
- All user management operations are logged (future enhancement)
- Users receive email notifications for important actions (future enhancement)
- Banned users cannot sign in
- Deleted users are permanently removed
- Sessions are properly revoked
- Role changes take effect immediately

## Technical Specifications

### Route Structure (Behave.js Pattern)
```
app/
  admin/
    page.tsx                                    # Dashboard home
    layout.tsx                                  # Admin layout (check permissions)
    users/
      page.tsx                                  # Users list page
      state.ts                                  # Jotai atoms for users data
      behaviors/
        list-users/
          actions/
            list-users.action.ts                # Server action
          use-list-users.ts                     # Hook with Jotai
          tests/
            list-users.spec.ts                  # E2E test
            list-users.action.test.ts           # Action test (PreDB/PostDB)
            use-list-users.test.tsx             # Hook test

        create-user/
          actions/
            create-user.action.ts
          use-create-user.ts
          tests/

        update-user/
          actions/
            update-user.action.ts
          use-update-user.ts
          tests/

        ban-user/
          actions/
            ban-user.action.ts
          use-ban-user.ts
          tests/

        unban-user/
          actions/
            unban-user.action.ts
          use-unban-user.ts
          tests/

        delete-user/
          actions/
            delete-user.action.ts
          use-delete-user.ts
          tests/

        impersonate-user/
          actions/
            impersonate-user.action.ts
          use-impersonate-user.ts
          tests/

        stop-impersonating/
          actions/
            stop-impersonating.action.ts
          use-stop-impersonating.ts
          tests/

        list-sessions/
          actions/
            list-sessions.action.ts
          use-list-sessions.ts
          tests/

        revoke-session/
          actions/
            revoke-session.action.ts
          use-revoke-session.ts
          tests/

        revoke-all-sessions/
          actions/
            revoke-all-sessions.action.ts
          use-revoke-all-sessions.ts
          tests/

        set-role/
          actions/
            set-role.action.ts
          use-set-role.ts
          tests/

        set-password/
          actions/
            set-password.action.ts
          use-set-password.ts
          tests/

services/
  admin-stats.service.ts                        # Dashboard statistics (if needed)

# NO Models needed - Better Auth manages users
# All admin operations use auth.api.* directly
```

### Components

**Dashboard Home (`/admin/page.tsx`)**

Layout structure:
```typescript
<div className="px-4 md:px-6 py-8 space-y-8">
  <h1 className="text-2xl font-semibold tracking-tight">Admin Dashboard</h1>

  <div className="grid gap-4 md:grid-cols-3">
    <StatsCard />
    <StatsCard />
    <StatsCard />
  </div>

  <div className="flex justify-start">
    <Button>Manage Users</Button>
  </div>
</div>
```

Components:
- `StatsCard`: Minimal card displaying metric
  - Structure: `<Card>` with `p-6`
  - Number: `text-3xl font-bold`
  - Label: `text-sm text-muted-foreground mt-1`
  - No icons, no colors (except banned users - subtle red)
  - Example:
    ```typescript
    <Card className="p-6">
      <div className="text-3xl font-bold">247</div>
      <div className="text-sm text-muted-foreground mt-1">Total Users</div>
    </Card>
    ```
- `ManageUsersButton`: Primary button linking to `/admin/users`

**Users List Page (`/admin/users/page.tsx`)**

Layout structure:
```typescript
<div className="px-4 md:px-6 py-8 space-y-6">
  {/* Page header */}
  <div className="flex items-center justify-between">
    <div>
      <h1 className="text-2xl font-semibold tracking-tight">Users</h1>
      <p className="text-sm text-muted-foreground mt-1">
        Manage user accounts and permissions
      </p>
    </div>
    <Button onClick={openCreateDialog}>
      <Plus className="mr-2 h-4 w-4" />
      Create User
    </Button>
  </div>

  {/* Toolbar */}
  <UsersTableToolbar />

  {/* Data table */}
  <UsersDataTable />
</div>
```

Components:
- `UsersDataTable`: Clean data table following Design System specs
  - Columns: Name, Email, Role (badge), Created At, Actions (dropdown)
  - Sticky header within table container: `sticky top-0 bg-muted/30 z-10`
  - Row hover effect: `hover:bg-muted/50`
  - Banned users: `bg-destructive/5` tint on entire row
  - Compact rows: `h-12`
  - Border: `border rounded-lg`

- `UsersTableToolbar`: Minimal toolbar
  ```typescript
  <div className="flex items-center gap-2 pb-4 border-b">
    <div className="flex-1 max-w-sm">
      <Input placeholder="Search by name or email..." />
    </div>
    <Select> {/* Role filter */}
      <SelectTrigger className="w-[180px]">
        <SelectValue placeholder="All roles" />
      </SelectTrigger>
    </Select>
    <DropdownMenu> {/* Column visibility */}
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="sm">
          <Filter className="mr-2 h-4 w-4" />
          Columns
        </Button>
      </DropdownMenuTrigger>
    </DropdownMenu>
  </div>
  ```

- `UserRowActions`: Three-dot menu (MoreHorizontal icon)
  - Items: Edit, Reset Password, Change Role, View Sessions, Impersonate
  - Separator before destructive actions
  - Destructive: Ban User, Delete User (text-destructive)

- **Dialogs** - All follow minimal dialog design from Design System:
  - `CreateUserDialog`: 4 fields (email, name, password, role)
  - `EditUserDialog`: 3 fields (email, name, role)
  - `BanUserDialog`: 2 fields (reason, expires in days)
  - `DeleteUserDialog`: Simple confirmation (destructive)
  - `ImpersonateDialog`: Simple confirmation with warning
  - `SessionsDialog`: Table of sessions with revoke buttons (max-w-2xl)
  - `SetRoleDialog`: Single select for role
  - `SetPasswordDialog`: Single password input

**Impersonation Banner** (appears on ALL pages when active)
```typescript
<Alert className="mb-4 border-warning bg-warning/10">
  <AlertDescription className="flex items-center justify-between">
    <span className="text-sm">
      <Shield className="inline mr-2 h-4 w-4" />
      Impersonating <strong>{user.name}</strong>
    </span>
    <Button
      variant="outline"
      size="sm"
      onClick={stopImpersonating}
    >
      Stop Impersonating
    </Button>
  </AlertDescription>
</Alert>
```

Design notes:
- NO sticky impersonation banner (breaks iframe)
- Banner appears inline at top of page content
- Repeats on every page while impersonating
- Warning color (subtle yellow tint)

### State Management (Jotai)

**`/admin/users/state.ts`**
```typescript
export const usersAtom = atom<User[]>([])
export const usersLoadingAtom = atom(false)
export const usersTotalAtom = atom(0)
export const usersPageAtom = atom(1)
export const usersLimitAtom = atom(10)
export const usersSearchAtom = atom('')
export const usersRoleFilterAtom = atom<string | undefined>(undefined)
export const usersSortByAtom = atom<string | undefined>(undefined)
export const usersSortDirectionAtom = atom<'asc' | 'desc'>('asc')
export const isImpersonatingAtom = atom(false)
export const impersonatedUserAtom = atom<User | null>(null)
```

### Architecture Layers

**NO Models Layer** - Better Auth manages users internally, no need for UserModel wrapper.

**Integrations Layer** (optional) - Only if complex logic needed:
- `AdminStatsIntegration` - Calculate dashboard statistics (if Better Auth doesn't provide this)

**Actions Layer** - All operations call Better Auth Admin API directly:
- Direct `auth.api.*` calls
- Zod validation
- Authorization checks
- Error handling

**Hooks Layer** - Frontend state management:
- Jotai for state
- Optimistic updates
- Call actions
- Rollback on error

---

### Server Actions (Backend)

All actions follow this pattern:

```typescript
"use server";

import { z } from "zod";
import { auth, getUser } from "@/lib/auth";
import { headers } from "next/headers";

// Define result interface
export interface ListUsersResult {
  users: User[];
  total: number;
  limit?: number;
  offset?: number;
  error?: string;
}

// Define input schema
const inputSchema = z.object({
  searchValue: z.string().optional(),
  searchField: z.enum(['email', 'name']).optional(),
  limit: z.number().min(1).max(100).optional(),
  offset: z.number().min(0).optional(),
  // ... other fields
});

// Action function
export async function listUsers(
  input: unknown
): Promise<ListUsersResult> {
  // 1. Authorization check
  const { user } = await getUser();
  if (!user || user.role !== 'admin') {
    return { users: [], total: 0, error: 'Unauthorized' };
  }

  // 2. Validate input
  const parsed = inputSchema.safeParse(input);
  if (!parsed.success) {
    return { users: [], total: 0, error: 'Invalid input' };
  }

  // 3. Call Better Auth Admin API
  try {
    const result = await auth.api.listUsers({
      query: {
        searchValue: parsed.data.searchValue,
        searchField: parsed.data.searchField,
        limit: parsed.data.limit || 10,
        offset: parsed.data.offset || 0,
        // ... other params
      },
      headers: await headers(), // Required for session
    });

    return {
      users: result.users,
      total: result.total,
      limit: result.limit,
      offset: result.offset,
    };
  } catch (error) {
    console.error('listUsers error:', error);
    return { users: [], total: 0, error: 'Failed to fetch users' };
  }
}
```

**Action Specifications:**

**`list-users.action.ts`**
```typescript
interface ListUsersInput {
  searchValue?: string;
  searchField?: 'email' | 'name';
  limit?: number;
  offset?: number;
  sortBy?: string;
  sortDirection?: 'asc' | 'desc';
  filterField?: string;
  filterValue?: string;
  filterOperator?: 'eq' | 'ne' | 'contains';
}
// Calls: auth.api.listUsers()
// Returns: { users, total, limit, offset, error? }
```

**`create-user.action.ts`**
```typescript
interface CreateUserInput {
  email: string;
  password: string;
  name: string;
  role?: 'user' | 'admin';
}
// Validation: email format, password min 8 chars, name required
// Calls: auth.api.createUser()
// Returns: { user?, error? }
```

**`update-user.action.ts`**
```typescript
interface UpdateUserInput {
  userId: string;
  data: {
    email?: string;
    name?: string;
    role?: string;
  };
}
// Calls: auth.api.adminUpdateUser()
// Returns: { user?, error? }
```

**`ban-user.action.ts`**
```typescript
interface BanUserInput {
  userId: string;
  banReason?: string;
  banExpiresIn?: number; // seconds
}
// Calls: auth.api.banUser()
// Returns: { success: boolean, error? }
```

**`unban-user.action.ts`**
```typescript
interface UnbanUserInput {
  userId: string;
}
// Calls: auth.api.unbanUser()
// Returns: { success: boolean, error? }
```

**`delete-user.action.ts`**
```typescript
interface DeleteUserInput {
  userId: string;
}
// Calls: auth.api.removeUser()
// Returns: { success: boolean, error? }
```

**`impersonate-user.action.ts`**
```typescript
interface ImpersonateUserInput {
  userId: string;
}
// Calls: auth.api.impersonateUser()
// Returns: { session?, error? }
```

**`stop-impersonating.action.ts`**
```typescript
// No input needed
// Calls: auth.api.stopImpersonating()
// Returns: { success: boolean, error? }
```

**`list-sessions.action.ts`**
```typescript
interface ListSessionsInput {
  userId: string;
}
// Calls: auth.api.listUserSessions()
// Returns: { sessions: Session[], error? }
```

**`revoke-session.action.ts`**
```typescript
interface RevokeSessionInput {
  sessionToken: string;
}
// Calls: auth.api.revokeUserSession()
// Returns: { success: boolean, error? }
```

**`revoke-all-sessions.action.ts`**
```typescript
interface RevokeAllSessionsInput {
  userId: string;
}
// Calls: auth.api.revokeUserSessions()
// Returns: { success: boolean, error? }
```

**`set-role.action.ts`**
```typescript
interface SetRoleInput {
  userId: string;
  role: string | string[];
}
// Calls: auth.api.setRole()
// Returns: { success: boolean, error? }
```

**`set-password.action.ts`**
```typescript
interface SetPasswordInput {
  userId: string;
  newPassword: string;
}
// Validation: password min 8 chars
// Calls: auth.api.setUserPassword()
// Returns: { success: boolean, error? }
```

---

### Hooks Pattern (Frontend)

Each hook follows this pattern with Jotai and optimistic updates:

```typescript
"use client";

import { useState } from "react";
import { z } from "zod";
import { useSetAtom } from "jotai";
import { usersAtom } from "../state";
import { createUser } from "./actions/create-user.action";

// Input validation schema
const createUserSchema = z.object({
  email: z.string().email('Invalid email'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
  name: z.string().min(1, 'Name is required'),
  role: z.enum(['user', 'admin']).optional().default('user'),
});

export function useCreateUser() {
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const setUsers = useSetAtom(usersAtom);

  const handleCreateUser = async (rawData: unknown) => {
    try {
      setIsLoading(true);
      setError(null);

      // 1. Client-side validation
      const validated = createUserSchema.parse(rawData);

      // 2. Optimistic update
      const tempId = `temp-${Date.now()}`;
      const tempUser = {
        id: tempId,
        email: validated.email,
        name: validated.name,
        role: validated.role,
        createdAt: new Date(),
        pending: true,
      };
      setUsers((prev) => [tempUser, ...prev]);

      // 3. Call server action
      const result = await createUser(validated);

      // 4. Handle result
      if (result.error) {
        // Rollback on error
        setUsers((prev) => prev.filter((u) => u.id !== tempId));
        setError(result.error);
        throw new Error(result.error);
      }

      // Replace temp user with real user
      setUsers((prev) =>
        prev.map((u) => (u.id === tempId ? result.user! : u))
      );

    } catch (err) {
      // Ensure rollback happened
      setError(err instanceof Error ? err.message : 'Failed to create user');
      throw err;
    } finally {
      setIsLoading(false);
    }
  };

  return {
    handleCreateUser,
    isLoading,
    error,
  };
}
```

**Hook Naming Convention**:
- Main handler: `handle[Operation]` (e.g., `handleCreateUser`, `handleBanUser`)
- Returns: `{ handle[Operation], isLoading, error }`

---

### Integrations (Optional)

Only create integrations if complex business logic is needed beyond what Better Auth provides.

**`integrations/admin-stats.integration.ts`** (if needed):
```typescript
import { db } from "@/db";
import { user, session } from "@/db/schema";
import { count, eq } from "drizzle-orm";

export const AdminStatsIntegration = {
  async getDashboardStats() {
    // If Better Auth doesn't provide these stats
    const [totalUsers] = await db.select({ count: count() }).from(user);
    const [activeSessions] = await db.select({ count: count() }).from(session);
    const [bannedUsers] = await db
      .select({ count: count() })
      .from(user)
      .where(eq(user.banned, true));

    return {
      totalUsers: totalUsers.count,
      activeSessions: activeSessions.count,
      bannedUsers: bannedUsers.count,
    };
  },
};
```

**Note**: Check if Better Auth Admin API already provides these stats before creating service.

---

### Authorization Pattern

Every action must check admin permissions:

```typescript
export async function someAction(input: unknown) {
  // ALWAYS check authorization first
  const { user } = await getUser();

  // Check if user is admin
  if (!user || user.role !== 'admin') {
    return { error: 'Unauthorized: Admin access required' };
  }

  // Optionally: check if user is in adminUserIds (from auth config)
  // Better Auth handles this internally in its admin API methods

  // Proceed with operation...
}
```

### UI Components

**shadcn/ui components** (already installed in project):
- Use existing components from `components/ui/`
- Follow shadcn data-table guide for table implementation
- All components already themed with default shadcn palette

### Middleware Protection

The `/admin` route is already protected by `middleware.ts`. Ensure:
- Only authenticated users can access
- Only users with `admin` role can perform actions
- Proper error messages for unauthorized access

### Testing Strategy

**Unit Tests (Vitest)**
- Test server actions with PreDB/PostDB pattern
- Test hooks with React Testing Library
- Use in-memory SQLite database
- Mock Better Auth responses where needed

**E2E Tests (Playwright)**
- Test complete user management flows
- Test impersonation flow
- Test pagination and filtering
- Test optimistic updates and rollbacks
- Use real browser interactions

### Error Handling

All operations should handle:
- Network errors
- Validation errors
- Authorization errors
- Database errors
- Display user-friendly error messages
- Roll back optimistic updates on failure

### Performance Considerations

- Paginate users list (default 10 per page)
- Debounce search input (300ms)
- Lazy load session data (only when dialog opens)
- Cache user list with Jotai
- Use optimistic updates for instant feedback

### Future Enhancements

- Audit log of all admin actions
- Email notifications for user actions
- Bulk operations (bulk ban, bulk delete, bulk role change)
- Export users to CSV
- Advanced filtering (by date range, by banned status, by email domain)
- Custom roles and permissions UI
- User activity timeline
- Two-factor authentication management

## Implementation Notes

### Implementation Order
1. **Design System Setup** - Configure shadcn theme, create reusable component primitives
2. **Dashboard Home** - Simple stats page to establish layout patterns
3. **List Users behavior** - Foundation for all CRUD operations
4. **Create User** - First write operation with dialog pattern
5. **Edit/Delete Users** - Build on established patterns
6. **Advanced operations** - Ban, impersonate, sessions
7. **Polish** - Loading states, error handling, animations

### Critical Design Guidelines

**Minimal Design**:
- Resist the urge to add charts, graphs, or visual flourishes
- Every UI element must have a functional purpose
- Use whitespace generously
- Monochromatic color scheme - color only for status/actions
- No gradients, no shadows (except dialogs), no decorative elements

**iframe Compatibility** (CRITICAL):
- Test EVERY feature inside an iframe during development
- NEVER use `position: fixed` for headers, footers, sidebars
- Dialogs are the ONLY exception (they can be fixed within iframe)
- All scroll happens within page content, not at page level
- Test with different iframe sizes (small, medium, full screen)
- Ensure focus management works across iframe boundary

**shadcn Best Practices**:
- Use shadcn components as-is, minimal customization
- Follow shadcn data-table example exactly for table implementation
- Use composition over configuration
- Prefer `cn()` utility for conditional classes
- Keep component variants minimal (only what's needed)

**Better Auth Integration**:
- All operations use Better Auth Admin API
- No direct database queries in admin panel
- Trust Better Auth types - don't create parallel type definitions
- Handle auth errors gracefully (session expired, insufficient permissions)

**Performance**:
- Optimize for iframe rendering (lighter than full page apps)
- Debounce search (300ms)
- Lazy load dialogs
- Use Jotai for minimal re-renders
- No unnecessary animations or transitions

**Accessibility**:
- All interactive elements keyboard accessible
- Focus visible states on all controls
- ARIA labels on icon-only buttons
- Semantic HTML (table, form, dialog)
- Screen reader tested (especially in iframe context)

**Testing in iframe**:
Create a test page:
```typescript
// app/admin-test/page.tsx
export default function AdminTestPage() {
  return (
    <div className="p-8">
      <h1>Admin Panel (Iframe Test)</h1>
      <iframe
        src="/admin"
        className="w-full h-[800px] border"
        title="Admin Panel"
      />
    </div>
  )
}
```

## Dependencies

### Already in Project
- `better-auth` with admin plugin
- `shadcn/ui` components (in `components/ui/`)
- `jotai` for state management
- `zod` for validation
- `react-hook-form` for forms
- `@tanstack/react-table` - Table implementation
- `lucide-react` - Icons

### May Need to Add
- `date-fns` - For date formatting (if not already installed)

Check `package.json` before adding dependencies.

## Visual Reference

### Complete Dashboard Page
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  Admin Dashboard                                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚    247      â”‚  â”‚     89      â”‚  â”‚      3      â”‚            â”‚
â”‚  â”‚ Total Users â”‚  â”‚   Active    â”‚  â”‚   Banned    â”‚            â”‚
â”‚  â”‚             â”‚  â”‚  Sessions   â”‚  â”‚    Users    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  [Manage Users]                                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Complete Users List Page
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                       â”‚
â”‚  Users                                           [+ Create User]      â”‚
â”‚  Manage user accounts and permissions                                â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [ğŸ” Search...]  [Role: All â–¾]  [Columns â–¾]                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ NAME            EMAIL               ROLE   CREATED      ACTIONS â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Alice Johnson   alice@example.com   Admin  Jan 15 2025    â‹®    â”‚ â”‚ â† Hover: light gray
â”‚  â”‚ Bob Smith       bob@example.com     User   Jan 14 2025    â‹®    â”‚ â”‚
â”‚  â”‚ Carol White     carol@example.com   User   Jan 13 2025    â‹®    â”‚ â”‚ â† Banned: light red tint
â”‚  â”‚ David Brown     david@example.com   User   Jan 12 2025    â‹®    â”‚ â”‚
â”‚  â”‚ Emma Davis      emma@example.com    User   Jan 11 2025    â‹®    â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Page 1 of 25               [< Previous]  [Next >]              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dialog Examples

**Create User Dialog**:
```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Create User         [Ã—]  â”‚
                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚                          â”‚
                  â”‚ Email                    â”‚
                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                  â”‚ â”‚                      â”‚ â”‚
                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                  â”‚                          â”‚
                  â”‚ Name                     â”‚
                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                  â”‚ â”‚                      â”‚ â”‚
                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                  â”‚                          â”‚
                  â”‚ Password                 â”‚
                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                  â”‚ â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢             â”‚ â”‚
                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                  â”‚                          â”‚
                  â”‚ Role                     â”‚
                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                  â”‚ â”‚ User              â–¾  â”‚ â”‚
                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                  â”‚                          â”‚
                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚      [Cancel]  [Create]  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Delete Confirmation Dialog**:
```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Delete User         [Ã—]  â”‚
                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚                          â”‚
                  â”‚ Are you sure you want to â”‚
                  â”‚ delete Alice Johnson?    â”‚
                  â”‚                          â”‚
                  â”‚ This action cannot be    â”‚
                  â”‚ undone. All user data    â”‚
                  â”‚ will be permanently      â”‚
                  â”‚ removed.                 â”‚
                  â”‚                          â”‚
                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚      [Cancel]  [Delete]  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â””â”€ Red button
```

**Sessions Dialog** (wider):
```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Active Sessions for Alice Johnson         [Ã—]  â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚ TOKEN      CREATED      IP          ACTION â”‚ â”‚
        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
        â”‚ â”‚ abc123...  2h ago    192.168.1.1  [Revoke]â”‚ â”‚
        â”‚ â”‚ def456...  1d ago    10.0.0.5     [Revoke]â”‚ â”‚
        â”‚ â”‚ ghi789...  3d ago    172.16.0.10  [Revoke]â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                                â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                   [Revoke All]      [Close]    â”‚
        â”‚                      â””â”€ Destructive            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Row Actions Dropdown
```
Hover on â‹® icon:

          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ âœï¸  Edit User    â”‚ â† Hover: light gray background
          â”‚ ğŸ”‘ Reset Passwordâ”‚
          â”‚ ğŸ‘¤ Change Role   â”‚
          â”‚ ğŸ”’ View Sessions â”‚
          â”‚ ğŸ‘ï¸  Impersonate  â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† Separator
          â”‚ ğŸš« Ban User      â”‚ â† Red text (not background)
          â”‚ ğŸ—‘ï¸  Delete User  â”‚ â† Red text
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Impersonation Banner (inline, NOT fixed)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸  Impersonating Alice Johnson        [Stop Impersonating]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€ Yellow/warning background, appears at top of every page content
```

### Badge Examples (in table)
```
Admin   â†’ Dark background, white text, rounded-full
User    â†’ Light gray background, dark text, rounded-full
Banned  â†’ Red background, white text, rounded-full
```

### Color Usage Examples

**Minimal color usage - only when necessary**:
- âœ… Banned row: Very subtle red tint (`bg-destructive/5`)
- âœ… Delete button: Red background
- âœ… Admin badge: Dark background
- âœ… Success toast: Green (temporary, disappears)
- âŒ NO colorful stats cards
- âŒ NO colored icons everywhere
- âŒ NO gradient backgrounds
- âŒ NO drop shadows except dialogs

### Spacing Examples

```
Page padding: 16px (mobile) â†’ 24px (desktop)
Card padding: 24px
Section gaps: 24px
Element spacing: 16px vertical
Table cell padding: 16px horizontal, 8px vertical
Button height: 36px (h-9)
Input height: 36px (h-9)
Row height: 48px (h-12)
```

## Migration Requirements

The Better Auth Admin plugin requires database migration to add:
- `role`, `banned`, `banReason`, `banExpires` to `user` table
- `impersonatedBy` to `session` table

Run after configuration:
```bash
bunx @better-auth/cli migrate
```

## Configuration Checklist

### Better Auth Setup
- [ ] Add `admin()` plugin to `lib/auth.ts`
- [ ] Add `adminClient()` plugin to `lib/auth-client.ts`
- [ ] Run database migration: `bunx @better-auth/cli migrate`
- [ ] Configure admin user IDs or create first admin user
- [ ] Test admin permissions in middleware
- [ ] Set up default role ("user")
- [ ] Configure impersonation session duration (1 hour default)
- [ ] Set banned user message

### Design System Setup
- [ ] Verify shadcn components needed are available in `components/ui/`
- [ ] Create reusable component primitives (StatsCard, etc.) in `app/admin/components/`
- [ ] Review Design System section and implement color/spacing guidelines
- [ ] Ensure Tailwind classes follow minimal design principles (no unnecessary decorations)

### Development Setup
- [ ] Create `/admin-test` page for iframe testing
- [ ] Configure VSCode/editor for Tailwind IntelliSense
- [ ] Add TypeScript types from Better Auth
- [ ] Set up Jotai DevTools (optional, development only)

### Testing Setup
- [ ] Test all pages in iframe (different sizes)
- [ ] Verify dialogs work in iframe context
- [ ] Test keyboard navigation
- [ ] Test with screen reader
- [ ] Verify focus management works
- [ ] Test on mobile devices (responsive)

### Production Readiness
- [ ] Remove console.logs and debug code
- [ ] Verify all error boundaries in place
- [ ] Test with slow network (loading states)
- [ ] Verify all optimistic updates rollback on error
- [ ] Audit for accessibility issues
- [ ] Performance audit (Lighthouse)
- [ ] Test iframe embedding in production-like environment
