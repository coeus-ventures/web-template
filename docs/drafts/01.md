# Admin Panel - Dynamic Database Management

## Overview

A dynamic admin panel that automatically generates spreadsheet-like interfaces for all database tables defined in the Drizzle schema. Built using shadcn's data-table component (TanStack Table), the admin panel introspects the schema at runtime and creates fully functional CRUD interfaces with zero configuration per table.

## Admin Tables List Page

The main admin page displays a list of all available database tables extracted from the Drizzle schema.

### Components

- **TableList**: Displays a grid of cards, each representing a database table with its name, record count, and a link to view the table.
- **TableCard**: Shows individual table information including table name, description (if available), total row count, and last modified timestamp.

### Behaviors

- **Navigate to table**: When user clicks a table card, they are redirected to `/admin/tables/[tableName]` to view and manage that table's data.
- **Refresh table stats**: When user clicks a refresh button, the table statistics (row counts, last modified) are updated.

## Admin Table View Page

Displays a single database table as a spreadsheet-like data grid with full CRUD capabilities.

### Components

- **DataTable**: Renders the table data using shadcn's data-table component with sortable columns, filtering, and pagination.
- **TableToolbar**: Contains search input for filtering, column visibility toggle, and "Add Row" button.
- **ColumnHeader**: Sortable column headers with ascending/descending indicators.
- **CellEditor**: Inline cell editing with type-specific input components (text input, checkbox for booleans, date picker for timestamps, JSON editor for JSON columns).
- **RowActions**: Dropdown menu on each row with "Edit", "Duplicate", and "Delete" options.
- **AddRowDialog**: Modal dialog for creating new records with a form generated from table schema.
- **EditRowDialog**: Modal dialog for editing existing records with pre-filled form values.
- **DeleteConfirmation**: Confirmation dialog before deleting a record.
- **Pagination**: Shows current page, total pages, and navigation controls.

### Behaviors

- **Sort column**: When user clicks a column header, the table data is sorted by that column in ascending order; clicking again sorts descending; clicking a third time removes sorting.
- **Filter rows**: When user types in the search input, the table is filtered in real-time to show only rows matching the search term across all text columns.
- **Toggle column visibility**: When user opens the column visibility dropdown and toggles a column checkbox, that column is shown or hidden in the table.
- **Add row**: When user clicks "Add Row" button, a dialog opens with a form containing inputs for all table columns (respecting required fields and data types); submitting the form creates a new record and adds it to the table with optimistic update.
- **Edit row**: When user clicks "Edit" in the row actions menu, a dialog opens with a pre-filled form; submitting updates the record with optimistic update.
- **Delete row**: When user clicks "Delete" in the row actions menu, a confirmation dialog appears; confirming the deletion removes the record with optimistic update and rollback on error.
- **Paginate results**: When user clicks next/previous page buttons, the table displays the next/previous set of records (10 per page by default).
- **Edit cell inline**: When user double-clicks a cell, it becomes editable; pressing Enter saves the change, pressing Escape cancels; changes are saved via server action with optimistic update.
- **Export table data**: When user clicks "Export" button in toolbar, the current table data (with applied filters) is downloaded as CSV or JSON.

## Technical Implementation Notes

### Schema Introspection

The admin panel will use a schema introspection utility that:
- Extracts all tables from `db/schema.ts`
- Reads column metadata: name, data type, nullable, primary key, unique, default values, references
- Maps Drizzle types to UI components (text → Input, boolean → Checkbox, timestamp → DatePicker, integer → NumberInput)

### Dynamic Column Generation

Columns for shadcn data-table will be generated dynamically:
```typescript
function generateColumns(tableMetadata) {
  return tableMetadata.columns.map(col => ({
    accessorKey: col.name,
    header: ({ column }) => <DataTableColumnHeader column={column} title={col.name} />,
    cell: ({ row }) => <CellRenderer value={row.getValue(col.name)} type={col.type} />
  }));
}
```

### Generic CRUD Server Actions

Server actions will accept table name as a parameter:
- `fetchTableData(tableName, { page, limit, filter, sort })`
- `insertRow(tableName, data)`
- `updateRow(tableName, id, data)`
- `deleteRow(tableName, id)`
- `updateCell(tableName, rowId, columnName, value)`

### State Management

- Jotai atoms for table data, loading states, and error handling
- Optimistic updates for all mutations (add, edit, delete)
- Automatic rollback on server action failure

### Validation

- Zod schemas generated from Drizzle column definitions
- Client-side validation before sending to server
- Server-side validation in actions
